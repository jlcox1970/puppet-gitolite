#!/bin/bash
export HOME=<%= @git_home %>
chmod +rx <%= @git_home %>

if [ "<%= @git_root %>" != "<%= @git_home %>/repositories" ]
then
    # Create the repository hosting path
    mkdir -p <%= @git_root %>
    chown git:git <%= @git_root %>

    # Make sure that there is a symlink to the new path so gitolite will use the
    # path for the repositories
    ln -s <%= @git_root %> <%= @git_home %>/repositories
fi

gitolite setup -pk <%= @git_home %>/install.pub

chmod +rx <%= @git_home %>/repositories -R
chmod 700 <%= @git_home %>/repositories/gitolite-admin.git -R

